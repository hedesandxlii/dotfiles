set nocompatible
set modelines=0

" Automatically installs 'vim-plug' if it is not installed.
if empty(glob('~/.vim/autoload/plug.vim'))
  silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs
    \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  autocmd VimEnter * PlugInstall --sync | source $MYVIMRC
endif

call plug#begin('~/.vim/plugged')
" Nerdtree
Plug 'scrooloose/nerdtree', { 'on': 'NERDTreeToggle' }
Plug 'Xuyuanp/nerdtree-git-plugin', { 'on': 'NERDTreeToggle' }

" 'hybrid numbers'
Plug 'jeffkreeftmeijer/vim-numbertoggle'

" YCM
"Plug 'Valloric/YouCompleteMe'

" Anderson theme
Plug 'gilgigilgil/anderson.vim'

" Jedi-vim (Autocomplete for python)
Plug 'davidhalter/jedi-vim'

call plug#end()

filetype plugin on
" Apply colorscheme.
colorscheme anderson

""""""""""""
" Mappings "
""""""""""""

let mapleader = ","
nnoremap <Leader><Space> :noh<CR>
nnoremap ; :

" Movement
nnoremap j gj
nnoremap k gk
nnoremap <tab> %

" Movement between splits.
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" Resize vertical splits
nnoremap <Leader>m :vertical resize -5<CR>
nnoremap <Leader>p :vertical resize +5<CR>

" Command mode with swedish keyboard layout
nnoremap ö :
nnoremap Ö :

" Open terminal with Ctrl+D (And then exit that with Ctrl+D aswell :D)
nnoremap <C-d> :sh<CR>

" vimrc
map <Leader>sv :source $MYVIMRC<CR>
map <Leader>ev <C-w><C-v><C-w><C-l>:e $MYVIMRC<CR>


""""""""""""
" Settings "
""""""""""""

" Formatting
set wrap
set textwidth=100
set formatoptions=qrn1
set colorcolumn=+1

" Tabs
set tabstop=4
set shiftwidth=4
set softtabstop=4
set autoindent
set smartindent
set cindent
set expandtab

" Folds
set foldmethod=indent
set foldlevel=1
set foldclose=all
set foldnestmax=1

" Search
set ignorecase
set smartcase
set incsearch
set showmatch
set hlsearch

" Misc
set scrolloff=10
set visualbell
set ttyfast
set ruler
set laststatus=2
set undofile
set number relativenumber
set gdefault
set autoread

" get rid those of nasty files
set undodir=/tmp//
set directory=/tmp//
set backupdir=/tmp//


""""""""""""""""""
" File specifics "
""""""""""""""""""
autocmd FileType python nnoremap <leader>; <Esc>:w<CR>:!clear;python3 %<CR>
autocmd FileType python nnoremap <leader>t <Esc>:w<CR>:!clear;mypy %<CR>

autocmd FileType markdown nnoremap <leader>o <Esc>:w<CR>:! $BROWSER %<CR>

""""""""""""""""
" Autocommands "
""""""""""""""""
autocmd FocusLost * :wa
autocmd BufEnter :syntax sync fromstart

" Fixes cursor on exit and leave.
autocmd VimEnter * silent exec "! echo -ne '\e[1 q'"
autocmd VimLeave * silent exec "! echo -ne '\e[5 q'"

augroup vimrc
  " Remove all vimrc autocommands
  autocmd!
  " Add them again
  au BufReadPre * setlocal foldmethod=indent
  au BufWinEnter * if &fdm == 'indent' | setlocal foldmethod=manual | endif
augroup END


"""""""""""""""""
" Plugin Config "
"""""""""""""""""

" Nerdtree config
map <C-t> :NERDTreeToggle<CR>	" Toggle NerdTree with Ctrl+t

" autocmd vimenter * NERDTree	" Automatically open Nerdtree with Vim
let NERDTreeChDirMode  = 2	" Changes pwd with root-node change
let NERDTRreeMinimalUI = 1
let NERDTRreeDirArrows = 1
let NERDTreeShowBookmarks = 1
let g:NERDTreeIndicatorMapCustom = {
    \ "Modified"  : "M",
    \ "Staged"    : "S",
    \ "Untracked" : "?",
    \ "Renamed"   : "➜",
    \ "Unmerged"  : "Unmerged",
    \ "Deleted"   : "✖",
    \ "Dirty"     : "✗",
    \ "Clean"     : "✔︎",
    \ 'Ignored'   : '☒',
    \ "Unknown"   : "?"
    \ }

" YCM
let g:ycm_python_binary_path = 'python3'
let g:ycm_autoclose_preview_window_after_completion=1
